<html>
<head>
  <title>RMT: termination</title>
  <style>
    .codebox {
        border:1px solid black;
        background-color:#EEEEFF;
        width:350px;
        overflow:auto;    
        padding:10px;
    }
    .codebox code {
        font-size:0.9em;
    }
  </style>
</head>
<body>

  <h2 id="Introduction"> Introduction </h2>
  <p>
    The goal of this page is to provide a short introduction to the RMT tool, how to install it together will all the prerequisites and how one can use the tool to prove partial correctness, and later total correctness of programs.
    You can use the links below to quickly navigate to the senction which interests you.
    <ul>
      <li> <a href="#Installation"> Installation and compilation </a> </li>
      <li> <a href="#Running_RMT"> Running RMT </a> </li>
      <li> <a href="#Using_RMT_to_prove_correctness"> Using RMT to prove correctness </a> </li>
      <li> <a href="#Observations_and_notes"> Observations and notes </a> </li>
    </ul>
  </p>

  <h2 id="Installation"> Installation and compilation </h2>
  <p>
    The RMT tool uses an SMT solver for logical proofs. As such, an SMT solver is needed before RMT can be used.
    <br/>
    By default, RMT uses the Z3 solver. You can download Z3 from <a href="https://github.com/Z3Prover/z3/releases">here</a> and follow the readme in order to complete the installation. To check that the installation completed successfully, you can run <i>z3</i> (with no input), in which case you should see the text below, or you can try to run z3 on an example from <a href="https://rise4fun.com/Z3/tutorial/"> here </a>.
    <div class="codebox">
      <code>
        Error: input file was not specified.
        For usage information: z3 -h
      </code>
    </div>
  </p>
  <p>
    Once Z3 has been installed, you can download the RMT tool using <i>git</i> by cloning it from the repository:
    <div class="codebox">
        <code>
          &gt; git clone https://github.com/ciobaca/rmt
        </code>
    </div>
  </p>
  <p>
    After cloning, you should compile the sources in the <i>src</i> folder.
    <div class="codebox">
        <code>
          &gt; g++ -O2 -Wall -o rmt src/*.cpp
        </code>
    </div>
  </p>
  <p>
    On Windows, you can also use Visual Studio for compilation, either by using <i>cl.exe</i> dirrectly or by creating a C++ Console Application project in the Visual Studio IDE and adding all the source files in the <i>src</i> folder. Not that we recommend compiling on Release and not on Debug, as there is a noticeable speed difference when running the tool.
    <br>
    After compilation, the tool should be ready to use.
  </p>

  <h2 id="Running_RMT"> Running RMT </h2>

  <p>
    The RMT tool reads from the standard input, so in order to run the RMT binary on a file, you just redirrect the file to stdin. For example, to run the tool on one of the examples included in the <i>examples</i> directory, you can run:
    <div class="codebox">
        <code>
          &gt; rmt.exe examples\z-all-examples\example1.rmt
        </code>
    </div>
  </p>
  <p>
    For this particular example, the tool should produce an output similar to this:
    <div class="codebox">
        <code>
          2 solutions.
          Solution #1:
          loop(mplus(S,N),mminus(N,mone)) if mle(mone,N)
          Solution #2:
          done(S) if bnot(mle(mone,N))
        </code>
    </div>
  </p>
  <p>
    More about running the tool, such as optional parameters, different commands that can be executed, troubleshooting etc can be found in the <i>README</i> file downloaded from the git repository.
  </p>

  <h2 id="Using_RMT_to_prove_correctness"> Using RMT to prove correctness </h2>
  <p>
    <i> The purpose of this section is to provide a small tutorial for how to use RMT to prove termination and total correctness. This assumes a familiarity with proofs of partial correctness using the tool. In order to learn about proofs of partial correctness, one can read the </i> README <i> file downloaded from the git repository and/or look through the various examples in the </i> examples/z-all-examples/ <i> directory. </i>
  </p>
  <p>
    One can use the <i>prove</i> command to prove a set of circularities within a rewrite system. However, under normal circumstances, this only guarantees partial correctness of programs. In order to prove termination and total correctness, one should follow a series of steps.
    <br/>
    First of all, the <i>instrument</i> command should be run to transform a given rewrite system into a new one, with transformed rules in such a way that avoid infinite transitions. This command takes 5 arguments, which are, in order:
    <ul>
      <li> the name of the old rewrite system; </li>
      <li> the name of the new rewrite system (this should be a fresh name in order to avoid problems); </li>
      <li> the sort of configurations in the old system; </li>
      <li> the sort of configurations in the new system (as above, this should be a fresh name); </li>
      <li> the name of a function symbol, called the "protect" function, which is applied over the cartesian product of the old configurations and integers and produces new configurations (again, this should be a fresh name). </li>
    </ul>
    An example of such a command in practice (taken from <i>examples\termination-examples\1.1_addition.rmt/</i>) would look like this:
    <div class="codebox">
        <code>
          instrument suma suma_protected State nState protect;
        </code>
    </div>
    where <i>protect</i> is a function symbol defined as follows:
    <div class="codebox">
        <code>
          protect:State Int->nState;
        </code>
    </div>
  </p>
  <p>
    Next step is creating a new system of circularities, equivalent to the one we were trying to prove before. For this, we can use the <i>cinstrument</i> command. This command is similar to the previously described <i>insturment</i>, however in addition to the 5 arguments mentioned before, one should also provide one <i>variant</i> (i.e. a term of integral sort) for each of the circularities in the system.
    <br/>
    Continuing with the example in <i>examples\termination-examples\1.1_addition.rmt/</i>, the application of the <i>cinstrument</i> command is as follows:
    <div class="codebox">
        <code>
          cinstrument circularities circularities_protected State nState protect mplus(y,mtwo);
        </code>
    </div>
  </p>
  <p>
    After all of this is done, we can now run the standard <i>prove</i> command in the new systems. This (if successful) guarantees total correctness. For clarity, here is how the final command is applied in the example above:
    <div class="codebox">
        <code>
          prove in suma_protected : circularities_protected;
        </code>
    </div>
  </p>

  <h2 id="Observations_and_notes"> Observations and notes </h2>
  <p>
    We note that the usage of the <i>instrument</i> and <i>cinstrument</i> commands have some prerequisites. They assume <i>Int</i> as being the sort of integers, <i>mzero</i> as being the integral constant <i>0</i> and <i>mminus</i> as being the function symbol which gets interpreted as subtraction of integers. These restrictions do not affect the generality of the tool (as sorts and symbols can be renamed at will), and will most likely be changed in the future, however one should still take note of them to avoid unexpected errors and crashes.
  </p>

</body>
</html>
